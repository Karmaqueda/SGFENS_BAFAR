
-----------------------------------------------
-----------------------------------------------
--VALIDACION DE XML EN PRETORIANO Y SCT, SCRIP PARA CREDITOS DE VALIDACION:
ALTER TABLE EMPRESA ADD CREDITO_VALIDA_XML INT(10) DEFAULT 0 COMMENT 'CREDITOS PARA VALIDACION DE XML';

--TABLA PARA LA VALIDACION DE COMPROBANTES FISCALES
CREATE TABLE VALIDACION_XML(
    ID_VALIDACION INT(10) NOT NULL AUTO_INCREMENT,
    ID_EMPRESA INT(10) NOT NULL,
    NOMBRE_ARCHIVO VARCHAR(200),
    VERSION_COMPROBANTE VARCHAR(5) COMMENT 'VERSION DEL COMPROBANTE, HASTA AHORA 2.2 O 3.2',
    CADENA_ORIGINAL TEXT,
    COMPROBANTE_VALIDO INT(1) COMMENT '1 COMPROBANTE VALIDO, 0 INVALIDO',
    SELLO_EMISOR_VALIDO INT(1) COMMENT '1 SELLO VALIDO, 0 INVALIDO',    
    TIMBRE_FISCAL TEXT,
    MENSAJES_ERROR TEXT COMMENT 'EN CASO DE ERROR, AQUI SE DESCRIBE EL O LOS ERRORES SEPARADOS POR CARACTER TIPLE PIPE',
    PRIMARY KEY(ID_VALIDACION)
);


-------------- PARA LOS IMPUESTOS POR CONCEPTO:

--TABLA PARA MUCHOS IMPUESTO POR CONCEPTO:
CREATE TABLE IMPUESTO_POR_CONCEPTO(
	ID_IMPUESTO_POR_CONCEPTO INT(10) NOT NULL AUTO_INCREMENT,
        ID_CONCEPTO INT(10) COMMENT 'ID DEL CONCEPTO',
        ID_IMPUESTO INT(10) COMMENT 'ID DEL IMPUESTO QUE ESTA LIGADO AL CONCEPTO',
        ID_ESTATUS INT(2) NOT NULL COMMENT '1 ACTIVO, 2 INACTIVO',
        PRIMARY KEY(ID_IMPUESTO_POR_CONCEPTO)
);

--TABLA DE LA DESCRIPCION DE LOS IMPUESTOS CAPTURADOS EN EL COMPROBANTE
CREATE TABLE COMPROBANTE_IMPUESTO_X_CONCEPTO(
    ID_COMPROBANTE_IMPUESTO INT(10) NOT NULL AUTO_INCREMENT,    
    ID_COMPROBANTE_FISCAL INT(10),
    ID_IMPUESTO INT(10),
    NOMBRE VARCHAR(100)NOT NULL,
    DESCRIPCION VARCHAR(100),
    PORCENTAJE NUMERIC(13,10) NOT NULL,
    TRASLADADO BOOLEAN DEFAULT FALSE, 
    IMPUESTO_LOCAL BOOLEAN DEFAULT TRUE,    
    PRIMARY KEY(ID_COMPROBANTE_IMPUESTO)  
);

ALTER TABLE CONCEPTO ADD IMPUESTO_X_CONCEPTO INT(1) DEFAULT 0 COMMENT '0 SI NO TIENE IMPUESTOS RELACIONADOS, 1 SI TIENE IMPUESTOS RELACIONADOS';
ALTER TABLE COMPROBANTE_DESCRIPCION ADD ID_IMPUESTO INT(10) DEFAULT 0 COMMENT '0 SI ES EXENTO DE IMPUESTO, ALGUN OTRO ID SI ESTA RELACIONADO A ALGUN IMPUESTO';
ALTER TABLE COMPROBANTE_DESCRIPCION ADD DESCUENTO_PORCENTAJE NUMERIC(8,4) DEFAULT 0 COMMENT 'SI METIO UN PORCENTAJE DE DESCUENTO DE ESTE CONCEPTO'; 
ALTER TABLE COMPROBANTE_DESCRIPCION ADD DESCUENTO_MONTO NUMERIC(20,4) DEFAULT 0 COMMENT 'SI METIO UN MONTO DE DESCUENTO DE ESTE CONCEPTO';
INSERT INTO TIPO_COMPROBANTE (ID_TIPO_COMPROBANTE, NOMBRE, DESCRIPCION) VALUES (41, 'FACTURA', 'Documento de Facturacion, Impuestos por Concepto');

-------------- FIN DE LOS IMPUESTOS POR CONCEPTO